<div class="container">

  <div class="row">

    <div class="col-12">


      <div class="card my-5">
        <div class="card-header">
          Orden de compra
        </div>
        <div class="card-block">
          <form #formCreateOrden="ngForm" id="formCreateOrden" (ngSubmit)="createOrden()">

            <ng-template #rt let-r="result" let-t="term">
              <span>{{r.nombre || ""}}</span>
            </ng-template>

            <div class="form-group row" [class.has-danger]="searchFailed">
              <label for="typeahead-http" class="col-sm-2 col-form-label">Buscar producto</label>
              <div class="col-sm-10">
                <input id="typeahead-http" name="typeahead-http" type="text" class="form-control" [(ngModel)]="producto" [ngbTypeahead]="searchProducto"
                  [resultTemplate]="rt" [inputFormatter]="formatterProducto" placeholder="" />
                <span *ngIf="searching">buscando...</span>
                <div class="form-control-feedback" *ngIf="searchFailed">No se encontraron productos.</div>
              </div>
            </div>

            <div class="form-group row" [class.has-danger]="searchFailed">
              <label for="typeahead-cliente" class="col-sm-2 col-form-label">Buscar cliente</label>
              <div class="col-sm-10">
                <input id="typeahead-cliente" name="typeahead-cliente" type="text" class="form-control" [(ngModel)]="cliente" [ngbTypeahead]="searchCliente"
                  [resultTemplate]="rt" [inputFormatter]="formatterCliente" placeholder="" />
                <span *ngIf="searching">buscando...</span>
                <div class="form-control-feedback" *ngIf="searchFailed">No se encontraron clientes.</div>
              </div>
            </div>


            <hr>
            <pre>Producto: {{ producto | json }}</pre>
            <pre>Cliente: {{ cliente | json }}</pre>

            <div class="form-group row">
              <label for="id_cliente" class="col-sm-2 col-form-label">Cliente</label>
              <div class="col-sm-10">
                <input class="form-control" type="text" name="id_cliente" id="id_cliente" [(ngModel)]="orden.id_cliente">
              </div>
            </div>

            <div class="form-group row">
              <label for="fecha_entrega" class="col-sm-2 col-form-label">Fecha Entrega</label>
              <div class="col-sm-10">
                <input class="form-control" type="text" name="fecha_entrega" id="fecha_entrega" [(ngModel)]="orden.fecha_entrega">
              </div>
            </div>

            <div class="form-group row">
              <label for="lugar_entrega" class="col-sm-2 col-form-label">Lugar Entrega</label>
              <div class="col-sm-10">
                <select class="form-control" name="lugar_entrega" id="lugar_entrega" [(ngModel)]="orden.lugar_entrega">
                  <option value="1">Obra</option>
                  <option value="2">Sucursal</option>
                  <option value="3">CDIS</option>                    
                </select>
              </div>
            </div>

            <div class="form-group row">
              <label for="direccion_entrega" class="col-sm-2 col-form-label">Direcci√≥n Entrega</label>
              <div class="col-sm-10">
                <input class="form-control" type="text" name="direccion_entrega" id="direccion_entrega" [(ngModel)]="orden.direccion_entrega">
              </div>
            </div>

            <div class="form-group row">
              <label for="id_forma_pago" class="col-sm-2 col-form-label">Forma de pago</label>
              <div class="col-sm-10">
                <select class="form-control" name="id_forma_pago" id="id_forma_pago" [(ngModel)]="orden.id_forma_pago">
                  <option [value]="forma.id_forma_pago" *ngFor="let forma of formas_pago">{{forma.nombre}}</option>                                 
                </select>
              </div>
            </div>
            <div class="form-group row">
              <label for="nota" class="col-sm-2 col-form-label">Nota</label>
              <div class="col-sm-10">
                <textarea class="form-control" rows="5" name="nota" id="nota" [(ngModel)]="orden.nota"></textarea>
              </div>
            </div>

            <div>Orden: {{orden|json}}</div>

          </form>
        </div>
        <div>
          <table class="table table-hover table-striped">
            <thead>
              <tr>
                <th>Producto</th>
                <th>Unidad</th>
                <th>Cantidad</th>
                <th></th>
              </tr>
              <tr>
                <td>
                  <input id="typeahead-http" name="typeahead-http" type="text" class="form-control" [(ngModel)]="producto" [ngbTypeahead]="searchProducto"
                    [resultTemplate]="rt" [inputFormatter]="formatterProducto" placeholder="" />
                </td>
                <td><input class="form-control" type="text" [(ngModel)]="producto.unidad" readonly></td>
                <td><input class="form-control" type="text" [(ngModel)]="producto.cantidad"></td>
                <td><button type="button" class="btn btn-primary" (click)="agregarProducto()">Agregar</button></td>
              </tr>
            </thead>

            <tbody>
              <tr *ngFor="let producto of productos_orden">
                <td>{{producto.nombre}}</td>
                <td>{{producto.unidad}}</td>
                <td>
                  <input type="number" class="form-control" [(ngModel)]="producto.cantidad">
                </td>
                <td>
                  <button md-icon-button (click)="delProducto(producto)">
                   <md-icon>delete</md-icon>
                  </button>                 
                </td>
              </tr>             
            </tbody>
          </table>
        </div>
        <div class="card-footer">
          <div>
            <button type="sbmit" form="formCreateOrden" class="btn btn-primary">Aceptar</button>
          </div>
        </div>
      </div>
    </div>

  </div>

</div>